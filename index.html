<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Welcome to smallcracker&#39;s personal website</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Welcome to smallcracker&#39;s personal website">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Welcome to smallcracker&#39;s personal website">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="smallcracker">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Welcome to smallcracker's personal website" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Welcome to smallcracker&#39;s personal website</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-max30102 stm32代码" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/27/max30102%20stm32%E4%BB%A3%E7%A0%81/" class="article-date">
  <time class="dt-published" datetime="2021-02-26T16:00:00.000Z" itemprop="datePublished">2021-02-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/27/max30102%20stm32%E4%BB%A3%E7%A0%81/">max30102 stm32代码</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="max30102-stm32代码"><a href="#max30102-stm32代码" class="headerlink" title="max30102 stm32代码"></a>max30102 stm32代码</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f10x.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;usart.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ultrasonic.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f10x_gpio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f10x_i2c.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span><span class="comment">//延时函数</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bsp_i2c_gpio.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*************************************************</span></span><br><span class="line"><span class="comment">函数: fputc(int ch, FILE *f)</span></span><br><span class="line"><span class="comment">功能: 重定向c库函数printf到USART1</span></span><br><span class="line"><span class="comment">参数: 无</span></span><br><span class="line"><span class="comment">返回: 无</span></span><br><span class="line"><span class="comment">**************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fputc</span><span class="params">(<span class="keyword">int</span> ch, FILE *f)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        USART_SendData(USART1, (<span class="keyword">unsigned</span> <span class="keyword">char</span>) ch);</span><br><span class="line">        <span class="keyword">while</span> (!(USART1-&gt;SR &amp; USART_FLAG_TXE));</span><br><span class="line">        <span class="keyword">return</span> (ch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*************************************************</span></span><br><span class="line"><span class="comment">函数: void main_init(void)</span></span><br><span class="line"><span class="comment">功能: main初始化</span></span><br><span class="line"><span class="comment">参数: 无</span></span><br><span class="line"><span class="comment">返回: 无</span></span><br><span class="line"><span class="comment">**************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        Usart_Init();</span><br><span class="line">        <span class="comment">//I2C1_GPIO_Config();</span></span><br><span class="line">        <span class="comment">//I2C1_Mode_config();</span></span><br><span class="line">        <span class="comment">//I2C1_Configuration();</span></span><br><span class="line">        bsp_InitI2C();</span><br><span class="line">        delay_init(<span class="number">72</span>);            <span class="comment">//延时初始化</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> u8 <span class="title">max30102_Bus_Read</span><span class="params">(u8 Register_Address)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">max30102_init</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*************************************************</span></span><br><span class="line"><span class="comment">函数: int main(void)</span></span><br><span class="line"><span class="comment">功能: main主函数</span></span><br><span class="line"><span class="comment">参数: 无</span></span><br><span class="line"><span class="comment">返回: 无</span></span><br><span class="line"><span class="comment">**************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        u8 temp_num=<span class="number">0</span>;</span><br><span class="line">        main_init();</span><br><span class="line">        </span><br><span class="line">        max30102_init();</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\r\n MAX30102  init  \r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                delay_ms(<span class="number">1000</span>);            </span><br><span class="line">                max30102_init();</span><br><span class="line">                temp_num = max30102_Bus_Read(<span class="number">0x1f</span>);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;当前温度 = %d\r\n&quot;</span>,temp_num);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> max30102_WR_address 0xAE</span></span><br><span class="line"></span><br><span class="line"><span class="function">u8 <span class="title">max30102_Bus_Write</span><span class="params">(u8 Register_Address, u8 Word_Data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 采用串行EEPROM随机读取指令序列，连续读取若干字节 */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第1步：发起I2C总线启动信号 */</span></span><br><span class="line">        i2c_Start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第2步：发起控制字节，高7bit是地址，bit0是读写控制位，0表示写，1表示读 */</span></span><br><span class="line">        i2c_SendByte(max30102_WR_address | I2C_WR);        <span class="comment">/* 此处是写指令 */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第3步：发送ACK */</span></span><br><span class="line">        <span class="keyword">if</span> (i2c_WaitAck() != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">goto</span> cmd_fail;        <span class="comment">/* EEPROM器件无应答 */</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第4步：发送字节地址 */</span></span><br><span class="line">        i2c_SendByte(Register_Address);</span><br><span class="line">        <span class="keyword">if</span> (i2c_WaitAck() != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">goto</span> cmd_fail;        <span class="comment">/* EEPROM器件无应答 */</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 第5步：开始写入数据 */</span></span><br><span class="line">        i2c_SendByte(Word_Data);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第6步：发送ACK */</span></span><br><span class="line">        <span class="keyword">if</span> (i2c_WaitAck() != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">goto</span> cmd_fail;        <span class="comment">/* EEPROM器件无应答 */</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 发送I2C总线停止信号 */</span></span><br><span class="line">        i2c_Stop();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;        <span class="comment">/* 执行成功 */</span></span><br><span class="line"></span><br><span class="line">cmd_fail: <span class="comment">/* 命令执行失败后，切记发送停止信号，避免影响I2C总线上其他设备 */</span></span><br><span class="line">        <span class="comment">/* 发送I2C总线停止信号 */</span></span><br><span class="line">        i2c_Stop();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">u8 <span class="title">max30102_Bus_Read</span><span class="params">(u8 Register_Address)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        u8  data;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第1步：发起I2C总线启动信号 */</span></span><br><span class="line">        i2c_Start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第2步：发起控制字节，高7bit是地址，bit0是读写控制位，0表示写，1表示读 */</span></span><br><span class="line">        i2c_SendByte(max30102_WR_address | I2C_WR);        <span class="comment">/* 此处是写指令 */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第3步：发送ACK */</span></span><br><span class="line">        <span class="keyword">if</span> (i2c_WaitAck() != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">goto</span> cmd_fail;        <span class="comment">/* EEPROM器件无应答 */</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第4步：发送字节地址， */</span></span><br><span class="line">        i2c_SendByte((<span class="keyword">uint8_t</span>)Register_Address);</span><br><span class="line">        <span class="keyword">if</span> (i2c_WaitAck() != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">goto</span> cmd_fail;        <span class="comment">/* EEPROM器件无应答 */</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第6步：重新启动I2C总线。下面开始读取数据 */</span></span><br><span class="line">        i2c_Start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第7步：发起控制字节，高7bit是地址，bit0是读写控制位，0表示写，1表示读 */</span></span><br><span class="line">        i2c_SendByte(max30102_WR_address | I2C_RD);        <span class="comment">/* 此处是读指令 */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第8步：发送ACK */</span></span><br><span class="line">        <span class="keyword">if</span> (i2c_WaitAck() != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">goto</span> cmd_fail;        <span class="comment">/* EEPROM器件无应答 */</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第9步：读取数据 */</span></span><br><span class="line">        &#123;</span><br><span class="line">                data = i2c_ReadByte();        <span class="comment">/* 读1个字节 */</span></span><br><span class="line"></span><br><span class="line">                i2c_NAck();        <span class="comment">/* 最后1个字节读完后，CPU产生NACK信号(驱动SDA = 1) */</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 发送I2C总线停止信号 */</span></span><br><span class="line">        i2c_Stop();</span><br><span class="line">        <span class="keyword">return</span> data;        <span class="comment">/* 执行成功 返回data值 */</span></span><br><span class="line"></span><br><span class="line">cmd_fail: <span class="comment">/* 命令执行失败后，切记发送停止信号，避免影响I2C总线上其他设备 */</span></span><br><span class="line">        <span class="comment">/* 发送I2C总线停止信号 */</span></span><br><span class="line">        i2c_Stop();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">max30102_FIFO_Read</span><span class="params">(u8 Register_Address,u16  Word_Data[][<span class="number">2</span>],u8 count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        u8 i=<span class="number">0</span>;</span><br><span class="line">        u8 no = count;</span><br><span class="line">        u8 data1, data2;</span><br><span class="line">        <span class="comment">/* 第1步：发起I2C总线启动信号 */</span></span><br><span class="line">        i2c_Start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第2步：发起控制字节，高7bit是地址，bit0是读写控制位，0表示写，1表示读 */</span></span><br><span class="line">        i2c_SendByte(max30102_WR_address | I2C_WR);        <span class="comment">/* 此处是写指令 */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第3步：发送ACK */</span></span><br><span class="line">        <span class="keyword">if</span> (i2c_WaitAck() != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">goto</span> cmd_fail;        <span class="comment">/* EEPROM器件无应答 */</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第4步：发送字节地址， */</span></span><br><span class="line">        i2c_SendByte((<span class="keyword">uint8_t</span>)Register_Address);</span><br><span class="line">        <span class="keyword">if</span> (i2c_WaitAck() != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">goto</span> cmd_fail;        <span class="comment">/* EEPROM器件无应答 */</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第6步：重新启动I2C总线。下面开始读取数据 */</span></span><br><span class="line">        i2c_Start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第7步：发起控制字节，高7bit是地址，bit0是读写控制位，0表示写，1表示读 */</span></span><br><span class="line">        i2c_SendByte(max30102_WR_address | I2C_RD);        <span class="comment">/* 此处是读指令 */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第8步：发送ACK */</span></span><br><span class="line">        <span class="keyword">if</span> (i2c_WaitAck() != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">goto</span> cmd_fail;        <span class="comment">/* EEPROM器件无应答 */</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 第9步：读取数据 */</span></span><br><span class="line">        <span class="keyword">while</span> (no)</span><br><span class="line">        &#123;</span><br><span class="line">                data1 = i2c_ReadByte();        </span><br><span class="line">                i2c_Ack();</span><br><span class="line">                data2 = i2c_ReadByte();</span><br><span class="line">                i2c_Ack();</span><br><span class="line">                Word_Data[i][<span class="number">0</span>] = (((u16)data1 &lt;&lt; <span class="number">8</span>) | data2);  <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">               </span><br><span class="line">                data1 = i2c_ReadByte();        </span><br><span class="line">                i2c_Ack();</span><br><span class="line">                data2 = i2c_ReadByte();</span><br><span class="line">                <span class="keyword">if</span>(<span class="number">1</span>==no)</span><br><span class="line">                        i2c_NAck();        <span class="comment">/* 最后1个字节读完后，CPU产生NACK信号(驱动SDA = 1) */</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                        i2c_Ack();</span><br><span class="line">                Word_Data[i][<span class="number">1</span>] = (((u16)data1 &lt;&lt; <span class="number">8</span>) | data2);</span><br><span class="line"></span><br><span class="line">                no--;        </span><br><span class="line">                i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 发送I2C总线停止信号 */</span></span><br><span class="line">        i2c_Stop();</span><br><span class="line"></span><br><span class="line">cmd_fail: <span class="comment">/* 命令执行失败后，切记发送停止信号，避免影响I2C总线上其他设备 */</span></span><br><span class="line">        <span class="comment">/* 发送I2C总线停止信号 */</span></span><br><span class="line">        i2c_Stop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INTERRUPT_REG 0X00</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">max30102_init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        </span><br><span class="line">        max30102_Bus_Write(<span class="number">0x09</span>, <span class="number">0x0b</span>);  <span class="comment">//mode configuration : temp_en[3]      MODE[2:0]=010 HR only enabled    011 SP02 enabled</span></span><br><span class="line">        max30102_Bus_Write(<span class="number">0x01</span>, <span class="number">0xF0</span>); <span class="comment">//open all of interrupt</span></span><br><span class="line">        max30102_Bus_Write(INTERRUPT_REG, <span class="number">0x00</span>); <span class="comment">//all interrupt clear</span></span><br><span class="line">        max30102_Bus_Write(<span class="number">0x03</span>, <span class="number">0x02</span>); <span class="comment">//DIE_TEMP_RDY_EN</span></span><br><span class="line">        max30102_Bus_Write(<span class="number">0x21</span>, <span class="number">0x01</span>); <span class="comment">//SET   TEMP_EN</span></span><br><span class="line"></span><br><span class="line">        max30102_Bus_Write(<span class="number">0x0a</span>, <span class="number">0x47</span>); <span class="comment">//SPO2_SR[4:2]=001  100 per second    LED_PW[1:0]=11  16BITS</span></span><br><span class="line"></span><br><span class="line">        max30102_Bus_Write(<span class="number">0x0c</span>, <span class="number">0x47</span>);</span><br><span class="line">        max30102_Bus_Write(<span class="number">0x0d</span>, <span class="number">0x47</span>);</span><br><span class="line">                                                                                       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/27/max30102%20stm32%E4%BB%A3%E7%A0%81/" data-id="cklnr0aal000fto3d2s1kan2z" data-title="max30102 stm32代码" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-IIC" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/26/IIC/" class="article-date">
  <time class="dt-published" datetime="2021-02-25T16:00:00.000Z" itemprop="datePublished">2021-02-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/26/IIC/">IIC</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="IIC"><a href="#IIC" class="headerlink" title="IIC"></a>IIC</h1><h2 id="一、IIC介绍"><a href="#一、IIC介绍" class="headerlink" title="一、IIC介绍"></a>一、IIC介绍</h2><p>I2C(Inter－Integrated Circuit)总线是80年代PHILIPS公司开发的两线式串行总线，如今已经成为芯片间低速串行通信的事实标准，被广泛使用在消费、控制类电子设备场合。这里的两个关键词两线和低速：<br><strong>两线</strong>意味着结构简单，<strong>低速</strong>意味着好实现，做电路的都知道速度越慢电路实现起来就越容易，而且协议方式也很优雅。所以这是一个简单、优雅、好实现、应用又广泛的电路协议。</p>
<h2 id="二、TM4C123GH6PM的I2C模块的特征"><a href="#二、TM4C123GH6PM的I2C模块的特征" class="headerlink" title="二、TM4C123GH6PM的I2C模块的特征"></a>二、TM4C123GH6PM的I2C模块的特征</h2><p>  内部集成电路（I2C）总线通过一个两线设计（串行数据线 SDA 和串行时钟线 SCL）来提供双向数据传输，并且与外部 I2C 器件诸如串行存储器（RAM 和 ROM），网络设备，LCD，音频发生器等联系。I2C 总线也可用于产品开发和制造的系统测试和诊断的目的。TM4C123GH6PM 微控制器提供与其他 I2C 总线上的设备交互（发送和接收）的能力。TM4C123GH6PM 控制器的 I2C 模块具有以下特点：</p>
<ul>
<li>可以用作master也可以用作slave<ul>
<li>两种情况下都支持发送和接受数据</li>
<li>同时支持主机和从机操作</li>
</ul>
</li>
<li>四个I2C模式<ul>
<li>主机发送模式</li>
<li>主机接收模式</li>
<li>从机发送模式</li>
<li>从机接收模式</li>
</ul>
</li>
<li>四个发送速率<ul>
<li>标准模式(100Kbps)</li>
<li>快速模式(400Kbps)</li>
<li>超快速模式(1bm’s)</li>
<li>高速模式(3.33bm’s)</li>
</ul>
</li>
<li>时钟低超时中断</li>
<li>双从地址能力</li>
<li>抗干扰</li>
<li>主机和从机中断的产生<ul>
<li>当主机发送或接收操作完成时（或因为错误终止时），产生中断</li>
<li>当从机发送数据或主机需要数据或检测到起始停止条件时，产生中断</li>
</ul>
</li>
<li>主机由仲裁和时钟同步，支持多主机，以及7位寻址模式<h2 id="三、结构图"><a href="#三、结构图" class="headerlink" title="三、结构图"></a>三、结构图</h2><img src="IIC结构图.png" alt="结构图"><h2 id="四、操作介绍"><a href="#四、操作介绍" class="headerlink" title="四、操作介绍"></a>四、操作介绍</h2><h3 id="1、主机操作"><a href="#1、主机操作" class="headerlink" title="1、主机操作"></a>1、主机操作</h3></li>
</ul>
<ol>
<li>当使用那些API操作I2C主机模块时，用户必须首先调用 <code>I2CMasterInitExpClk()</code>函数，这个函数可以设置总线速率、使能主机模块。  </li>
<li>首先设置从机地址 <code>I2CMasterSlaveAddrSet()</code>，这个函数还可以用于设置定义是发送（向从机写）还是接收（从从机读）。</li>
<li>然后如果当前总线是一个多主机主线的话，我们这个主机要先调用<code>l I2CMasterBusBusy()</code>函数。这个函数可以确定这个主线忙不忙。</li>
<li>最后，如果是想发送数据，就调用<code>I2CMasterDataPut()</code>函数，可以将要传送的数据存入I2C主机数据寄存器中。<code>I2CMasterControl()</code>控制I2C主机的状态（也就是发送一个指令），这样的指令就能操纵总线，发送开始序列，发送从机地址和方向。剩余部分的传送可以通过轮询或者中断的方法来进行。下面是指令的内容<br><img src="IIC_CMD.jpg" alt="IIC_CMD"><blockquote>
<p>关于轮询模式和中断模式的介绍  </p>
<ul>
<li>For the single send and receive cases, the polling method involves looping on the return fromI2CMasterBusy(). Once that function indicates that the I2C master is no longer busy, the bus transaction has been completed and can be checked for errors using I2CMasterErr(). If there are no errors, then the data has been sent or is ready to be read using I2CMasterDataGet().  </li>
<li>For the burst send and receive cases, the polling method also involves calling the I2CMasterControl() function for each byte transmitted or received (using either the I2C_MASTER_CMD_BURST_SEND_CONT or I2C_MASTER_CMD_BURST_RECEIVE_CONT commands), and for the last byte sent or received (using either the I2C_MASTER_CMD_BURST_SEND_FINISH or I2C_MASTER_CMD_BURST_RECEIVE_FINISH commands). If any error is detected during the burst transfer, the I2CMasterControl() function should be called using the appropriate stop command (I2C_MASTER_CMD_BURST_SEND_ERROR_STOP or I2C_MASTER_CMD_BURST_RECEIVE_ERROR_STOP).  </li>
<li>For the interrupt-driven transaction, the user must register an interrupt handler for the I2C devices and enable the I2C master interrupt; the interrupt occurs when the master is no longer busy. </li>
</ul>
<p>具体功能需结合数据手册的相应位查看<br>I2C_MASTER_CMD_BURST_SEND_START<br>起始信号+从机地址+应答+从机寄存器+应答<br>I2C_MASTER_CMD_BURST_SEND_CONT<br>数据+应答<br>I2C_MASTER_CMD_BURST_SEND_FINISH<br>I2C_MASTER_CMD_BURST_SEND_STOP<br>停止信号<br>I2C_MASTER_CMD_BURST_RECEIVE_START<br>起始信号+从机地址+应答+从机寄存器+应答<br>I2C_MASTER_CMD_BURST_RECEIVE_CONT<br>接收数据+应答<br>I2C_MASTER_CMD_BURST_RECEIVE_FINISH<br>停止信号<br>注意<br>I2C_MASTER_CMD_SINGLE_SEND<br>起始信号+从机地址+应答+数据+应答<br>与I2C_MASTER_CMD_BURST_SEND_CONT区别：多了起始信号+从机地址+应答<br> I2C_MASTER_CMD_SINGLE_RECEIVE<br>起始信号+从机地址+应答+接收数据+应答<br>同上！  </p>
<h3 id="2-从机模式"><a href="#2-从机模式" class="headerlink" title="2.从机模式"></a>2.从机模式</h3><p>当使用I2C从机模式时，用户需要调用<code>I2CSlaveInit()</code>函数。这个函数可以使能I2C从机模块，初始化从机地址。然后，根据操作的不同，用户可以调用<code>I2CSlaveDataPut()</code>或者<code>I2CSlaveDataGet()</code>来完成传输。或者可以通过中断来完成传输操作。中断用<code>I2CIntRegister()</code>来注册</p>
<h2 id="五、驱动包含在-driverlib-i2c-c-和-driverlib-i2c-h-里"><a href="#五、驱动包含在-driverlib-i2c-c-和-driverlib-i2c-h-里" class="headerlink" title="五、驱动包含在 driverlib/i2c.c 和 driverlib/i2c.h 里"></a>五、驱动包含在 driverlib/i2c.c 和 driverlib/i2c.h 里</h2><h2 id="六、例程"><a href="#六、例程" class="headerlink" title="六、例程"></a>六、例程</h2><p>这里先给出一个loopback的程序（无需连接外置I2C设备，自发自收）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uint32_t</span> pui32DataTx[NUM_I2C_DATA];</span><br><span class="line"><span class="keyword">uint32_t</span> pui32DataRx[NUM_I2C_DATA];</span><br><span class="line"><span class="keyword">uint32_t</span> ui32Index;</span><br><span class="line">SysCtlPeripheralEnable(SYSCTL_PERIPH_I2C0);</span><br><span class="line">SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOB);</span><br><span class="line">GPIOPinConfigure(GPIO_PB2_I2C0SCL);</span><br><span class="line">GPIOPinConfigure(GPIO_PB3_I2C0SDA);</span><br><span class="line">GPIOPinTypeI2CSCL(GPIO_PORTB_BASE, GPIO_PIN_2);</span><br><span class="line">GPIOPinTypeI2C(GPIO_PORTB_BASE, GPIO_PIN_3);</span><br><span class="line">I2CLoopbackEnable(I2C0_BASE);</span><br><span class="line">I2CMasterInitExpClk(I2C0_BASE, SysCtlClockGet(), <span class="literal">false</span>);</span><br><span class="line">I2CSlaveEnable(I2C0_BASE);</span><br><span class="line">I2CSlaveInit(I2C0_BASE, SLAVE_ADDRESS);</span><br><span class="line">I2CMasterSlaveAddrSet(I2C0_BASE, SLAVE_ADDRESS, <span class="literal">false</span>);</span><br><span class="line">pui32DataTx[<span class="number">0</span>] = <span class="string">&#x27;I&#x27;</span>;</span><br><span class="line">pui32DataTx[<span class="number">1</span>] = <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">pui32DataTx[<span class="number">2</span>] = <span class="string">&#x27;C&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>(ui32Index = <span class="number">0</span>; ui32Index &lt; NUM_I2C_DATA; ui32Index++)&#123;</span><br><span class="line">    pui32DataRx[ui32Index] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(ui32Index = <span class="number">0</span>; ui32Index &lt; NUM_I2C_DATA; ui32Index++)&#123;</span><br><span class="line">    I2CMasterDataPut(I2C0_BASE, pui32DataTx[ui32Index]);</span><br><span class="line">    I2CMasterControl(I2C0_BASE, I2C_MASTER_CMD_SINGLE_SEND);</span><br><span class="line">    <span class="keyword">while</span>(!(I2CSlaveStatus(I2C0_BASE) &amp; I2C_SLAVE_ACT_RREQ))&#123;&#125;</span><br><span class="line">    pui32DataRx[ui32Index] = I2CSlaveDataGet(I2C0_BASE);</span><br><span class="line">    <span class="keyword">while</span>(I2CMasterBusy(I2C0_BASE))&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(ui32Index = <span class="number">0</span>; ui32Index &lt; NUM_I2C_DATA; ui32Index++)&#123;</span><br><span class="line">    pui32DataRx[ui32Index] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">I2CMasterSlaveAddrSet(I2C0_BASE, SLAVE_ADDRESS, <span class="literal">true</span>);</span><br><span class="line">I2CMasterControl(I2C0_BASE, I2C_MASTER_CMD_SINGLE_RECEIVE);</span><br><span class="line"><span class="keyword">while</span>(!(I2CSlaveStatus(I2C0_BASE) &amp; I2C_SLAVE_ACT_TREQ))&#123;&#125;</span><br><span class="line"><span class="keyword">for</span>(ui32Index = <span class="number">0</span>; ui32Index &lt; NUM_I2C_DATA; ui32Index++)&#123;</span><br><span class="line">    I2CSlaveDataPut(I2C0_BASE, pui32DataTx[ui32Index]);</span><br><span class="line">    I2CMasterControl(I2C0_BASE, I2C_MASTER_CMD_SINGLE_RECEIVE);</span><br><span class="line">    <span class="keyword">while</span>(!(I2CSlaveStatus(I2C0_BASE) &amp; I2C_SLAVE_ACT_TREQ))&#123;&#125;</span><br><span class="line">    pui32DataRx[ui32Index] = I2CMasterDataGet(I2C0_BASE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ol>
<hr>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/31086959">简单优雅的总线协议——I2C</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38427678/article/details/94328208">TM4C123Gx单片机之—-I2C接口笔记</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43529046/article/details/90792308">TM4C123G 硬件I2C</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/26/IIC/" data-id="cklnr0aai0008to3dasq7c7n7" data-title="IIC" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-sg90" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/24/sg90/" class="article-date">
  <time class="dt-published" datetime="2021-02-23T16:00:00.000Z" itemprop="datePublished">2021-02-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/24/sg90/">sg90操作</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="sg90舵机操作模板"><a href="#sg90舵机操作模板" class="headerlink" title="sg90舵机操作模板"></a>sg90舵机操作模板</h1><h2 id="接线："><a href="#接线：" class="headerlink" title="接线："></a>接线：</h2><p>上线黄色为PWM输入信号；中线橙色接入电源正极；bai下线棕色接入电源负极。</p>
<h2 id="版本一：使用延时函数实现"><a href="#版本一：使用延时函数实现" class="headerlink" title="版本一：使用延时函数实现"></a>版本一：使用延时函数实现</h2><h2 id=""><a href="#" class="headerlink" title=""></a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> angle;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="number">0</span>,door=<span class="number">50</span>;</span><br><span class="line">    <span class="comment">//定义接入sg90舵机信号线的引脚</span></span><br><span class="line">    SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOF);</span><br><span class="line">    GPIOPinTypeGPIOOutput(GPIO_PORTF_BASE, GPIO_PIN_2);</span><br><span class="line">    <span class="keyword">for</span>(;;)&#123;</span><br><span class="line">        door=angle*<span class="number">10</span>/<span class="number">9</span>+<span class="number">50</span>;</span><br><span class="line">        cnt++;</span><br><span class="line">        <span class="keyword">if</span>(cnt&gt;<span class="number">2000</span>)cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(cnt==<span class="number">0</span>)GPIOPinWrite(GPIO_PORTF_BASE, GPIO_PIN_2, GPIO_PIN_2),UARTprintf(<span class="string">&quot;%d\n&quot;</span>,angle);</span><br><span class="line">        <span class="keyword">if</span>(cnt==door)GPIOPinWrite(GPIO_PORTF_BASE, GPIO_PIN_2, <span class="number">0</span>);</span><br><span class="line">        ROM_SysCtlDelay (clock/ <span class="number">300000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><h2 id="版本二：使用PWM实现"><a href="#版本二：使用PWM实现" class="headerlink" title="版本二：使用PWM实现"></a>版本二：使用PWM实现</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先配置PWM</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ConfigurePWM</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//系统时钟是50Mhz 这里进行64分频 得到7812500hzPWM频率</span></span><br><span class="line">    SysCtlPWMClockSet(SYSCTL_PWMDIV_64);</span><br><span class="line">    <span class="comment">//选择使用的引脚</span></span><br><span class="line">    SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOF);</span><br><span class="line">    SysCtlPeripheralEnable(SYSCTL_PERIPH_PWM1);</span><br><span class="line">    GPIOPinTypePWM(GPIO_PORTF_BASE, GPIO_PIN_2);</span><br><span class="line">    <span class="comment">//配置信号分配</span></span><br><span class="line">    GPIOPinConfigure(GPIO_PF2_M1PWM6);</span><br><span class="line">    <span class="comment">//配置PWM发生器</span></span><br><span class="line">    PWMGenConfigure(PWM1_BASE, PWM_GEN_3, PWM_GEN_MODE_DOWN | PWM_GEN_MODE_NO_SYNC);</span><br><span class="line">    <span class="comment">//配置周期 表示50hz</span></span><br><span class="line">    PWMGenPeriodSet(PWM1_BASE, PWM_GEN_3, <span class="number">15625</span>);</span><br><span class="line">    <span class="comment">//配置占空比</span></span><br><span class="line">    PWMPulseWidthSet(PWM1_BASE, PWM_OUT_6, <span class="number">390</span>);</span><br><span class="line">    <span class="comment">//使能PWM模块1输出</span></span><br><span class="line">    PWMOutputState(PWM1_BASE, PWM_OUT_6_BIT, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//使能PWM发生器</span></span><br><span class="line">    PWMGenEnable(PWM1_BASE, PWM_GEN_3);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//然后是旋转函数</span></span><br><span class="line"><span class="keyword">int</span> angle;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    PWMPulseWidthSet(PWM1_BASE, PWM_OUT_6, <span class="number">625</span>*angle/<span class="number">72</span>+<span class="number">15625</span>/<span class="number">40</span>);</span><br><span class="line">    PWMGenEnable(PWM1_BASE, PWM_GEN_3);</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/24/sg90/" data-id="cklnr0aam000ito3dcyvt9agi" data-title="sg90操作" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DHT11 温湿度传感器" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/31/DHT11%20%E6%B8%A9%E6%B9%BF%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8/" class="article-date">
  <time class="dt-published" datetime="2021-01-30T16:00:00.000Z" itemprop="datePublished">2021-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/31/DHT11%20%E6%B8%A9%E6%B9%BF%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8/">DHT11温湿度传感器</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="DHT11温湿度传感器"><a href="#DHT11温湿度传感器" class="headerlink" title="DHT11温湿度传感器"></a>DHT11温湿度传感器</h1><h3 id="一、外观"><a href="#一、外观" class="headerlink" title="一、外观"></a>一、外观</h3><p><img src="image-20210131194115189.png" alt="image-20210131194115189" style="zoom: 50%;" /></p>
<h3 id="二、参数特性"><a href="#二、参数特性" class="headerlink" title="二、参数特性"></a>二、参数特性</h3><p><img src="image-20210131194217788.png" alt="image-20210131194217788" style="zoom: 67%;" /></p>
<h3 id="三、引脚说明"><a href="#三、引脚说明" class="headerlink" title="三、引脚说明"></a>三、引脚说明</h3><p>s端是信号端，串行数据，负号端是负极，中间是正极，正极供电电压要求在3.5-5.5V之间</p>
<h3 id="四、数据格式"><a href="#四、数据格式" class="headerlink" title="四、数据格式"></a>四、数据格式</h3><p>一次传送40位数据，高位先出。格式规定如下</p>
<blockquote>
<p>8位湿度整数数据+8位湿度小数数据+8位温度整数数据+8位温度小数数据+8位校验位</p>
</blockquote>
<p><em>其中校验位数据的定义是前四组数据和的后8位</em></p>
<p><img src="C:\Users\smallcannabis\AppData\Roaming\Typora\typora-user-images\image-20210131195059673.png" alt="image-20210131195059673" style="zoom:50%;" /></p>
<h3 id="五、数据时序"><a href="#五、数据时序" class="headerlink" title="五、数据时序"></a>五、数据时序</h3><p>DHT11的总体通信流程。第一步：主机先发送开始信号，从机会返回一个相应信号进行应答。   第二步：主机信号线拉高准备接收数据。   第三部：开始接收数据（一次接收40位）。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/31/DHT11%20%E6%B8%A9%E6%B9%BF%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8/" data-id="cklnr0a9s0000to3d8ap237w2" data-title="DHT11温湿度传感器" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Analog Comparator（待完成）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/30/Analog%20Comparator%EF%BC%88%E5%BE%85%E5%AE%8C%E6%88%90%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2021-01-29T16:00:00.000Z" itemprop="datePublished">2021-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/30/Analog%20Comparator%EF%BC%88%E5%BE%85%E5%AE%8C%E6%88%90%EF%BC%89/">Analog Comparator</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Analog-Comparator"><a href="#Analog-Comparator" class="headerlink" title="Analog Comparator"></a>Analog Comparator</h1><h3 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h3><p>模拟比较器可以将一个测试电压和一个独立的外部参考电压，共用的外部参考电压或共用的内部参考电压进行比较。它可以把比较结果输出到引脚上，也可以用于触发中断、触发ADC采样。它的中断产生逻辑是独立于ADC触发逻辑的，所以，AC可以基于一个事件产生一个中断，ADC可以基于另一个事件产生触发。比如说，让上升沿触发一次中断，让下降沿触发一次ADC。</p>
<p>该芯片提供了两个独立的模拟比较器。</p>
<p><img src="image-20210130173507102.png" alt="照片"><br><img src="image-20210130173536884.png" alt="image-20210130173536884"><br>原理演示图<br><img src="image-20210130173642377.png" alt="image-20210130173642377"><br>它的头文件是driverlib/comp.h</p>
<h3 id="二、函数介绍"><a href="#二、函数介绍" class="headerlink" title="二、函数介绍"></a>二、函数介绍</h3><p><img src="image-20210130100105290.png" alt="image-20210130100105290"></p>
<ol>
<li><code>ComparatorConfigure()</code> 用来配置一个AC模块触发ADC模块的条件、触发中断的条件、和谁比较、正常输出还是反转输出</li>
<li><code>ComparatorIntClear()</code> 用于清除比较器中断标志，<em>（ 小贴士，因为在Contex-M处理器中写入有缓冲，所以执行函数之后过几个周期中断源才可能真正被清除，所以我们推荐在中断函数的一开始就清除中断标识）</em></li>
<li><code>ComparatorIntDisable()</code> 失能一个比较器中断</li>
<li><code>ComparatorIntEnable()</code> 使能一个比较器中断</li>
<li><code>ComparatorIntRegister()</code> 注册中断函数</li>
<li><code>ComparatorIntStatus()</code> 获取当前中断状态</li>
<li><code>ComparatorIntUnregister()</code> 注销一个中断函数</li>
<li><code>ComparatorRefSet()</code> 设定内部参考电压</li>
<li><code>ComparatorValueGet()</code> 获取当前比较器输出值，<strong>true</strong>表示比较器输出是高，<strong>false</strong>表示比较器输出是低</li>
</ol>
<ul>
<li>此外还需要用到一些GPIO函数来实现比较器功能<ol>
<li><code>GPIOPinTypeComparator()</code> 配置引脚用于模拟比较器输入</li>
<li><code>GPIOPinTypeComparatorOutput()</code> 配置引脚作为模拟比较器输出</li>
</ol>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/30/Analog%20Comparator%EF%BC%88%E5%BE%85%E5%AE%8C%E6%88%90%EF%BC%89/" data-id="cklnr0aae0003to3d4xms30rk" data-title="Analog Comparator" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-FPU" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/30/FPU/" class="article-date">
  <time class="dt-published" datetime="2021-01-29T16:00:00.000Z" itemprop="datePublished">2021-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/30/FPU/">FPU</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="FPU"><a href="#FPU" class="headerlink" title="FPU"></a>FPU</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>FPU指的是浮点运算单元。默认情况下，我们不能使用浮点数，只有使能了FPU才能浮点数。如果不打开浮点运算单元就用浮点数的话，单片机就会产生一个NOCP错误。（RTOS可以利用这个特性判断哪一项任务使用了浮点运算单元，以此只在涉及到这些任务的task switch中执行FPU。）</p>
<p>当处理器执行一条中断命令时，有三种办法处理浮点运算内容：1.不去算 2.总是存下来浮点运算内容 3.对浮点运算内容执行一个 lazy save/restore 。</p>
<p>如果不去算的话，中断栈帧就和没有浮点运算单元的Cortex-M 处理器的就一样了。（当那些主程序用到浮点运算，中断函数不用浮点运算时，这种方法会特别好用）(没看出来)（我们像这样不存储浮点运算内容的话，就能减少对栈的使用，降低中断延迟）</p>
<p>除此以外，我们还能把浮点运算内容存储总是到栈里面。这种方法允许在中断函数里面使用浮点运算，代价是栈的使用会增加，中断延迟会增加（因为我们还要向栈里面多写一些东西）。这种方法还有一个优点，那就是在中断函数的栈帧内一直存着浮点运算单元。</p>
<p>对浮点运算内容的默认处理是执行一个lazy save/restore。当我们开始一个中断时，在栈里面我们为浮点运算内容预留出一部分空间（留着一会往里面写内容）。这种方法能降低中断的延迟，因为一会我们就只用去声明整数了。然后如果要执行一个浮点运算的话，我们就把浮点运算内容写到这个浮点运算指令前面。最终，当从中断返回的时候，浮点运算内容就会留在栈里面，直到它被复写。这种方法既保证了中断的快速反应，用能让我们在中断函数 里面使用浮点运算指令。</p>
<p>FPU在异常出现时会产生一个中断（比如说向下、向上溢出、除以零、无效操作，非法输入等情况下）。我们可以利用这些中断搞事情。</p>
<p>FPU也是可以被改造的。我们可以改造半精度浮点数值得格式，对无穷大数的处理，清零模式（这会牺牲完整的IEEE规范来提升速度）以及结果的循环模式。</p>
<p>头文件是driverlib/fpu.h</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/30/FPU/" data-id="cklnr0aaf0004to3dfs0l1ay8" data-title="FPU" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-总体概述" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/29/%E6%80%BB%E4%BD%93%E6%A6%82%E8%BF%B0/" class="article-date">
  <time class="dt-published" datetime="2021-01-28T17:46:41.002Z" itemprop="datePublished">2021-01-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<p>title:单片机总体概述<br>date：2021-1-29</p>
<h2 id="tag：单片机"><a href="#tag：单片机" class="headerlink" title="tag：单片机"></a>tag：单片机</h2><h2 id="微控制器"><a href="#微控制器" class="headerlink" title="微控制器"></a>微控制器</h2><p>这一款单片机的微控制器是TM4C123GH6PMI</p>
<h2 id="特色"><a href="#特色" class="headerlink" title="特色"></a>特色</h2><p>有TM4C123GH6PMI微控制器USB2.0 设备接口，休眠模块，运动控制脉宽调制模块</p>
<h2 id="什么是时钟"><a href="#什么是时钟" class="headerlink" title="什么是时钟"></a>什么是时钟</h2><p>时钟就是单片机的心脏。每跳动一下。整个单片机的各个电路就同步的动作一下。就好像我们做广播体操的时候 广播上喊的节拍1234 2234 3234。。。。然后我们全部的同学就按照这个节奏进行一个个动作。节拍越快我们动作越快。节拍越慢我们动作的越慢。</p>
<h2 id="内部时钟和外部时钟"><a href="#内部时钟和外部时钟" class="headerlink" title="内部时钟和外部时钟?"></a>内部时钟和外部时钟?</h2><p>PIC单片机有许多型号可以设置成 用外部时钟(如外部接个4MHZ的石英晶振)，也可以设置成用内部RC时钟。而且还有许多型号可以选择多种频率的时钟。</p>
<p>如 PICLF1823 内部时钟最高可以到达32MHZ 最低可以达到 31kHz. 这事实上提供了一条降低功耗的新路子。一般的单片机降低功耗常常用的睡眠，而睡眠期间CPU是什么都不做。如果希望降低功耗，而且CPU也能工作。降低时钟频率无疑是个非常好的选择。</p>
<h2 id="单片机里内部外设和外设有哪些"><a href="#单片机里内部外设和外设有哪些" class="headerlink" title="单片机里内部外设和外设有哪些"></a>单片机里内部外设和外设有哪些</h2><h4 id="单片机内部的外设"><a href="#单片机内部的外设" class="headerlink" title="单片机内部的外设"></a>单片机内部的外设</h4><p>一般包括：串口控制模块，SPI模块，I2C模块，A/D模块，PWM模块，CAN模块，EEPROM，比较器模块，等等，它们都集成在单片机内部，有相对应的内部控制寄存器，可通过单片机指令直接控制。</p>
<h4 id="单片机外部的外围功能模块"><a href="#单片机外部的外围功能模块" class="headerlink" title="单片机外部的外围功能模块"></a>单片机外部的外围功能模块</h4><p>比如键盘控制芯片，液晶，A/D转换芯片，等等。外设可通过单片机的I/O，SPI，I2C等总线控制。</p>
<h2 id="什么是-DSP-中的“内部上拉”和“内部下拉”"><a href="#什么是-DSP-中的“内部上拉”和“内部下拉”" class="headerlink" title="什么是 DSP 中的“内部上拉”和“内部下拉”?"></a>什么是 DSP 中的“内部上拉”和“内部下拉”?</h2><p>DSP 中介绍引脚时，注明 PU,PD 说是“内部上拉”和“内部下拉”，就是说内部已经配置了接电源的上拉电阻或是接地的下拉电阻。这样，当作为输入端口连接 OC 或COMS 芯片或浮空时。信号线平是确定的高/低电平。而不是不确定的浮地电平。内部上拉，相当于输入和电源之间接了一个几十 K 的电阻；下拉，相当于用电阻和地相连。</p>
<h2 id="VCC、VDD、VSS-是什么"><a href="#VCC、VDD、VSS-是什么" class="headerlink" title="VCC、VDD、VSS 是什么"></a>VCC、VDD、VSS 是什么</h2><p>在电子电路中，VCC 是电路的供电电压，C = circuit,表示电路的意思；VDD 是芯片<br>的工作电压，D = device,表示器件的意思；VSS 是接地或是负极，S = series,表示公共连<br>接的意思。</p>
<h2 id="TI坑人的一点在哪"><a href="#TI坑人的一点在哪" class="headerlink" title="TI坑人的一点在哪"></a>TI坑人的一点在哪</h2><p>TI不同于３２，TI的函数的入口参数无法通过像３２一样的方法查找选择合适的参数</p>
<h1 id="我的单片机的外设"><a href="#我的单片机的外设" class="headerlink" title="我的单片机的外设"></a>我的单片机的外设</h1><p>红灯PF1  M0PWM5</p>
<p>蓝灯PF2 M1PWM6</p>
<p>绿灯PF3 M1PWM7</p>
<p>按键1 PF4 按下为低电平</p>
<p>按键2 PF0按下为低电平</p>
<p><img src="C:\Users\smallcannabis\AppData\Roaming\Typora\typora-user-images\image-20201212200237248.png" alt="image-20201212200237248"></p>
<h2 id="延时函数"><a href="#延时函数" class="headerlink" title="延时函数"></a>延时函数</h2><p>SysCtlDelay ( SysCtlClockGet() *ms / 3000);</p>
<hr>
<h2 id="基本模板"><a href="#基本模板" class="headerlink" title="基本模板"></a>基本模板</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;inc/hw_memmap.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;inc/hw_types.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;inc/hw_ints.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;inc/hw_memmap.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;inc/hw_pwm.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/debug.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/fpu.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/gpio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/pin_map.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/rom.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/rom_map.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/sysctl.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/uart.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;utils/uartstdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/systick.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/interrupt.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/pwm.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">    FPULazyStackingEnable();</span><br><span class="line">    <span class="comment">//使能系统时钟为50MHz</span></span><br><span class="line">    SysCtlClockSet(SYSCTL_SYSDIV_4 | SYSCTL_USE_PLL | SYSCTL_XTAL_16MHZ | SYSCTL_OSC_MAIN);</span><br><span class="line">    <span class="comment">//延时函数</span></span><br><span class="line">    ROM_SysCtlDelay ( SysCtlClockGet() *ms / <span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/29/%E6%80%BB%E4%BD%93%E6%A6%82%E8%BF%B0/" data-id="cklnr0aap000pto3dcom3hsun" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-软件消抖" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/29/%E8%BD%AF%E4%BB%B6%E6%B6%88%E6%8A%96/" class="article-date">
  <time class="dt-published" datetime="2021-01-28T17:46:41.000Z" itemprop="datePublished">2021-01-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<p>title：软件消抖怎样实现<br>date：2021-1-29</p>
<h2 id="tag：单片机"><a href="#tag：单片机" class="headerlink" title="tag：单片机"></a>tag：单片机</h2><h1 id="软件消抖"><a href="#软件消抖" class="headerlink" title="软件消抖"></a>软件消抖</h1><p>软件消抖的基本原理是：在检测到有按键按下时，不是立即认定此键已被按下，而是执行一个10ms左右(具体时间应视所使用的按键进行调整)的延时程序后，再确认该键<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/电平/5695184">电平</a>是否仍然保持闭合状态电平，若仍然保持，则确认该键真正被按下。</p>
<p>这样的做法实时性差</p>
<p>启用一个定时中断，每 2ms 进一次中断，扫描一次按键状态并且存储起来，连续扫描 8 次后，看看这连续 8 次的按键状态是否是一致的。8 次按键的时间大概是 16ms，这 16ms 内如果按键状态一直保持一致，那就可以确定现在按键处于稳定的阶段，而非处于抖动的阶段。</p>
<p>这样的做法更好</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/29/%E8%BD%AF%E4%BB%B6%E6%B6%88%E6%8A%96/" data-id="cklnr0aar000sto3dbw4y6821" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-创建项目" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/29/%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE/" class="article-date">
  <time class="dt-published" datetime="2021-01-28T17:46:40.996Z" itemprop="datePublished">2021-01-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<p>title：怎样新建一个项目<br>date：2021-1-29</p>
<h2 id="tag：单片机"><a href="#tag：单片机" class="headerlink" title="tag：单片机"></a>tag：单片机</h2><h1 id="怎样新建一个项目"><a href="#怎样新建一个项目" class="headerlink" title="怎样新建一个项目"></a>怎样新建一个项目</h1><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><ul>
<li>file- new ccs project</li>
<li>target里选择c系列</li>
<li>后面选择对应的单片机</li>
<li>connection里面选择stellaris</li>
<li>name里面起一个名字</li>
<li>下面选择with main.c</li>
</ul>
<h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><ul>
<li><p>设置工程</p>
</li>
<li><p>打开projects 的properties</p>
</li>
<li><p>打开build的arm compiler 的include options 添加ti中的Tiva ware c这个文件夹</p>
</li>
<li><p>还有arm linker 的file search path的上面的那个框 其中要添加Tiva ware c这个文件夹中的driverlib的ccs 的debug的driverlib.lib</p>
</li>
</ul>
<p>这样就配置完成了，可以开始写代码了</p>
<hr>
<h2 id="基本模板"><a href="#基本模板" class="headerlink" title="基本模板"></a>基本模板</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;inc/hw_memmap.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;inc/hw_types.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;inc/hw_ints.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;inc/hw_memmap.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;inc/hw_pwm.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/debug.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/fpu.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/gpio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/pin_map.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/rom.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/rom_map.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/sysctl.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/uart.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;utils/uartstdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/systick.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/interrupt.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;driverlib/pwm.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ConfigureUART</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ROM_SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOA);</span><br><span class="line">    ROM_SysCtlPeripheralEnable(SYSCTL_PERIPH_UART0);</span><br><span class="line">    ROM_GPIOPinConfigure(GPIO_PA0_U0RX);</span><br><span class="line">    ROM_GPIOPinConfigure(GPIO_PA1_U0TX);</span><br><span class="line">    ROM_GPIOPinTypeUART(GPIO_PORTA_BASE, GPIO_PIN_0 | GPIO_PIN_1);</span><br><span class="line">    UARTClockSourceSet(UART0_BASE, UART_CLOCK_PIOSC);</span><br><span class="line">    UARTStdioConfig(<span class="number">0</span>, <span class="number">115200</span>, <span class="number">16000000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> clock;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">    FPULazyStackingEnable();</span><br><span class="line">    <span class="comment">//使能系统时钟为50MHz</span></span><br><span class="line">    SysCtlClockSet(SYSCTL_SYSDIV_4 | SYSCTL_USE_PLL | SYSCTL_XTAL_16MHZ | SYSCTL_OSC_MAIN);</span><br><span class="line">    <span class="comment">//延时函数</span></span><br><span class="line">    clock=SysCtlClockGet();</span><br><span class="line">    ROM_SysCtlDelay ( clock *ms / <span class="number">3000</span>);</span><br><span class="line">    ConfigureUART();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/29/%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE/" data-id="cklnr0aaq000qto3d10zxbpzk" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ADC interrupt" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/29/ADC%20interrupt/" class="article-date">
  <time class="dt-published" datetime="2021-01-28T16:00:00.000Z" itemprop="datePublished">2021-01-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/29/ADC%20interrupt/">ADC中断</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ADC中断"><a href="#ADC中断" class="headerlink" title="ADC中断"></a>ADC中断</h1><h3 id="一、相关函数介绍"><a href="#一、相关函数介绍" class="headerlink" title="一、相关函数介绍"></a>一、相关函数介绍</h3><ol>
<li><code>ADCIntRegister()</code> 和<code>ADCIntUnregister()</code>用于为ADC中断注册（注销）一个中断函数</li>
<li><code>ADCIntEnable()</code> 和 <code>ADCIntDisable</code> 使能（失能）一个采样序列中断</li>
<li><code>ADCIntClear()</code> 清除采样序列中断源</li>
<li><code>ADCIntStatus()</code> 获取当前中断状态</li>
</ol>
<h3 id="二、怎样触发中断"><a href="#二、怎样触发中断" class="headerlink" title="二、怎样触发中断"></a>二、怎样触发中断</h3><p>在配置采样通道的时候，如果参数设置有 <code>ADC_CTL_IE</code> 那么当这个通道采集完之后就会产生一个中断。</p>
<h3 id="三、例子"><a href="#三、例子" class="headerlink" title="三、例子"></a>三、例子</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">configureADC</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SysCtlPeripheralEnable(SYSCTL_PERIPH_ADC0);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//选择E3引脚（即CH0）作为ADC输入</span></span><br><span class="line">    SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOE);</span><br><span class="line">    GPIOPinTypeADC(GPIO_PORTE_BASE, GPIO_PIN_3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置采样序列发生器等</span></span><br><span class="line">    ADCSequenceConfigure(ADC0_BASE, <span class="number">0</span>, ADC_TRIGGER_PROCESSOR, <span class="number">0</span>);</span><br><span class="line">    ADCSequenceStepConfigure(ADC0_BASE, <span class="number">0</span>, <span class="number">0</span>,ADC_CTL_IE | ADC_CTL_END | ADC_CTL_CH0);</span><br><span class="line">	</span><br><span class="line">    ADCSequenceEnable(ADC0_BASE, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置ADC中断</span></span><br><span class="line">    ADCIntRegister(ADC0_BASE, <span class="number">0</span> , convet);</span><br><span class="line">    ADCIntEnable(ADC0_BASE, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="四、注意"><a href="#四、注意" class="headerlink" title="四、注意"></a>四、注意</h3><p>在写中断函数的时候记得清除中断标记，因为清除中断需要几个时钟周期，所以，我们需要在中断函数一开始就清除中断。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/29/ADC%20interrupt/" data-id="cklnr0aab0001to3ddjns3va3" data-title="ADC中断" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/midi/" rel="tag">midi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/midi/" style="font-size: 10px;">midi</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 20px;">单片机</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/02/27/max30102%20stm32%E4%BB%A3%E7%A0%81/">max30102 stm32代码</a>
          </li>
        
          <li>
            <a href="/2021/02/26/IIC/">IIC</a>
          </li>
        
          <li>
            <a href="/2021/02/24/sg90/">sg90操作</a>
          </li>
        
          <li>
            <a href="/2021/01/31/DHT11%20%E6%B8%A9%E6%B9%BF%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8/">DHT11温湿度传感器</a>
          </li>
        
          <li>
            <a href="/2021/01/30/Analog%20Comparator%EF%BC%88%E5%BE%85%E5%AE%8C%E6%88%90%EF%BC%89/">Analog Comparator</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 smallcracker<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<!--script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>