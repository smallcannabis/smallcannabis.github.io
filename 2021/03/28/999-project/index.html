<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>stm32_template | Welcome to smallcracker&#39;s personal website</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="简介在ti的开发过程中，我常将所有外设的配置以及程序功能的实现全部放在main.c里，随着功能的增加，代码长度也在增加，最终导入一个模板代码就已经将近两百行，为代码的编辑带来很大不便。最近转到stm32上来后，了解到正点原子的项目架构，觉得这样的常见功能封装成库的思路很有益处，因此我采集了正点原子例程中一些调试常用功能，加入一些改造和整合，得到了这样一个模板库：BASIC.h 使用简介创建目录时将">
<meta property="og:type" content="article">
<meta property="og:title" content="stm32_template">
<meta property="og:url" content="http://example.com/2021/03/28/999-project/index.html">
<meta property="og:site_name" content="Welcome to smallcracker&#39;s personal website">
<meta property="og:description" content="简介在ti的开发过程中，我常将所有外设的配置以及程序功能的实现全部放在main.c里，随着功能的增加，代码长度也在增加，最终导入一个模板代码就已经将近两百行，为代码的编辑带来很大不便。最近转到stm32上来后，了解到正点原子的项目架构，觉得这样的常见功能封装成库的思路很有益处，因此我采集了正点原子例程中一些调试常用功能，加入一些改造和整合，得到了这样一个模板库：BASIC.h 使用简介创建目录时将">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-03-27T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-28T08:48:05.646Z">
<meta property="article:author" content="smallcracker">
<meta property="article:tag" content="stm32">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Welcome to smallcracker's personal website" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Welcome to smallcracker&#39;s personal website</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">联系方式：1426090870</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-999-project" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/28/999-project/" class="article-date">
  <time class="dt-published" datetime="2021-03-27T16:00:00.000Z" itemprop="datePublished">2021-03-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      stm32_template
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在ti的开发过程中，我常将所有外设的配置以及程序功能的实现全部放在main.c里，随着功能的增加，代码长度也在增加，最终导入一个模板代码就已经将近两百行，为代码的编辑带来很大不便。最近转到stm32上来后，了解到正点原子的项目架构，觉得这样的常见功能封装成库的思路很有益处，因此我采集了正点原子例程中一些调试常用功能，加入一些改造和整合，得到了这样一个模板库：BASIC.h</p>
<h2 id="使用简介"><a href="#使用简介" class="headerlink" title="使用简介"></a>使用简介</h2><p>创建目录时将BASIC文件夹复制到项目文件夹中，在keil的项目group里加入BASIC里个各个.c文件，在<code>options for target</code>里的c/c++选项include栏目里加入BASIC文件夹即可开始使用。</p>
<p>使用这个项目只需引用BASIC.h库即可，其他所有库均在这个库里面</p>
<h2 id="功能介绍"><a href="#功能介绍" class="headerlink" title="功能介绍"></a>功能介绍</h2><h3 id="延时函数"><a href="#延时函数" class="headerlink" title="延时函数"></a>延时函数</h3><blockquote>
<p>这部分内容由nxs7提供</p>
</blockquote>
<p>函数原型：<code>void Wait(u32 time)//time &lt;= 1864</code></p>
<p>功能：让程序延时time ms</p>
<h3 id="使能中断"><a href="#使能中断" class="headerlink" title="使能中断"></a>使能中断</h3><blockquote>
<p>这部分内容由正点原子提供,直接操作寄存器</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置NVIC </span></span><br><span class="line"><span class="comment">//NVIC_PreemptionPriority:抢占优先级</span></span><br><span class="line"><span class="comment">//NVIC_SubPriority       :响应优先级</span></span><br><span class="line"><span class="comment">//NVIC_Channel           :中断编号</span></span><br><span class="line"><span class="comment">//NVIC_Group             :中断分组 0~4</span></span><br><span class="line"><span class="comment">//注意优先级不能超过设定的组的范围!否则会有意想不到的错误</span></span><br><span class="line"><span class="comment">//组划分:</span></span><br><span class="line"><span class="comment">//组0:0位抢占优先级,4位响应优先级</span></span><br><span class="line"><span class="comment">//组1:1位抢占优先级,3位响应优先级</span></span><br><span class="line"><span class="comment">//组2:2位抢占优先级,2位响应优先级</span></span><br><span class="line"><span class="comment">//组3:3位抢占优先级,1位响应优先级</span></span><br><span class="line"><span class="comment">//组4:4位抢占优先级,0位响应优先级</span></span><br><span class="line"><span class="comment">//NVIC_SubPriority和NVIC_PreemptionPriority的原则是,数值越小,越优先	   </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MY_NVIC_Init</span><span class="params">(u8 NVIC_PreemptionPriority,u8 NVIC_SubPriority,u8 NVIC_Channel,u8 NVIC_Group)</span>	 </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">	u32 temp;	</span><br><span class="line">	MY_NVIC_PriorityGroupConfig(NVIC_Group);<span class="comment">//设置分组</span></span><br><span class="line">	temp=NVIC_PreemptionPriority&lt;&lt;(<span class="number">4</span>-NVIC_Group);	  </span><br><span class="line">	temp|=NVIC_SubPriority&amp;(<span class="number">0x0f</span>&gt;&gt;NVIC_Group);</span><br><span class="line">	temp&amp;=<span class="number">0xf</span>;								<span class="comment">//取低四位  </span></span><br><span class="line">	NVIC-&gt;ISER[NVIC_Channel/<span class="number">32</span>]|=(<span class="number">1</span>&lt;&lt;NVIC_Channel%<span class="number">32</span>);<span class="comment">//使能中断位(要清除的话,相反操作就OK) </span></span><br><span class="line">	NVIC-&gt;IP[NVIC_Channel]|=temp&lt;&lt;<span class="number">4</span>;		<span class="comment">//设置响应优先级和抢断优先级   	    	  				   </span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>这个函数用起来非常方便，比如，我们想为TIM3注册一个TIM3_IRQn中断的话，只需使用<code>MY_NVIC_Init(0,3,TIM3_IRQn,2);</code>即可，无需使用中断初始化结构体。</p>
<h3 id="按键"><a href="#按键" class="headerlink" title="按键"></a>按键</h3><p>初始化函数：<code>void KEY_init(void)</code></p>
<p>在这个库中，我们借助TIM3，实现了KEY0，KEY1和WK_UP 的<strong>短按，长按和组合使用</strong>的功能，默认为输出操作信息。欲修改按键功能请到KEY.c文件中修改相关部分。</p>
<h3 id="LED"><a href="#LED" class="headerlink" title="LED"></a>LED</h3><p>初始化函数： <code>void LED_init(void)</code></p>
<p>之后点灯的操作非常简单，比如 LED0 = 1；就是让第一个灯亮</p>
<h3 id="USART"><a href="#USART" class="headerlink" title="USART"></a>USART</h3><p>初始化函数： </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化IO 串口1</span></span><br><span class="line"><span class="comment">//pclk2:PCLK2时钟频率(Mhz)</span></span><br><span class="line"><span class="comment">//bound:波特率 </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">USART_init</span><span class="params">(u32 pclk2,u32 bound)</span></span></span><br></pre></td></tr></table></figure>
<p>之后只需使用<code>printf()</code>即可通过串口输出信息。具备完整的printf功能。（这里就要比ti强很多）</p>
<p>此外，还提供通过串口的信息接收功能。默认功能是将受到的信息原样发出，通过修改<code>USART.c</code>中的<code>analyseMessage()</code>函数可以实现任意解析接收受到的输出。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/28/999-project/" data-id="cko4hr64a000frw0k26wdempe" data-title="stm32_template" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stm32/" rel="tag">stm32</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/04/30/cc2541/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          CC2541
        
      </div>
    </a>
  
  
    <a href="/2021/03/27/004-USART/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">stm32_USART</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/" rel="tag">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/midi/" rel="tag">midi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stm32/" rel="tag">stm32</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%9A%E4%BF%A1/" rel="tag">通信</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/midi/" style="font-size: 10px;">midi</a> <a href="/tags/stm32/" style="font-size: 15px;">stm32</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 20px;">单片机</a> <a href="/tags/%E9%80%9A%E4%BF%A1/" style="font-size: 10px;">通信</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/30/cc2541/">CC2541</a>
          </li>
        
          <li>
            <a href="/2021/03/28/999-project/">stm32_template</a>
          </li>
        
          <li>
            <a href="/2021/03/27/004-USART/">stm32_USART</a>
          </li>
        
          <li>
            <a href="/2021/03/26/003-systick/">stm32-systick</a>
          </li>
        
          <li>
            <a href="/2021/03/23/002-GPIO/">stm32_GPIO</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 smallcracker<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<!--script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>