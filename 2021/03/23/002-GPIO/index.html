<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>stm32_GPIO | Welcome to smallcracker&#39;s personal website</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="stm32 GPIOGPIO基本结构说明：    保护二极管：IO引脚上下两边两个二极管用于防止引脚外部过高、过低的电压输入。当引脚电压高于VDD时，上方的二极管导通；当引脚电压低于VSS时，下方的二极管导通，防止不正常电压引入芯片导致芯片烧毁。但是尽管如此，还是不能直接外接大功率器件，须加大功率及隔离电路驱动，防止烧坏芯片或者外接器件无法正常工作。 P-MOS管和N-MOS管：由P-MOS管和N">
<meta property="og:type" content="article">
<meta property="og:title" content="stm32_GPIO">
<meta property="og:url" content="http://example.com/2021/03/23/002-GPIO/index.html">
<meta property="og:site_name" content="Welcome to smallcracker&#39;s personal website">
<meta property="og:description" content="stm32 GPIOGPIO基本结构说明：    保护二极管：IO引脚上下两边两个二极管用于防止引脚外部过高、过低的电压输入。当引脚电压高于VDD时，上方的二极管导通；当引脚电压低于VSS时，下方的二极管导通，防止不正常电压引入芯片导致芯片烧毁。但是尽管如此，还是不能直接外接大功率器件，须加大功率及隔离电路驱动，防止烧坏芯片或者外接器件无法正常工作。 P-MOS管和N-MOS管：由P-MOS管和N">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2021/03/23/002-GPIO/20180408224319518.png">
<meta property="og:image" content="http://example.com/2021/03/23/002-GPIO/浮空输入.png">
<meta property="og:image" content="c:/primary-project/stm32/学习心得/上拉输入模式.png">
<meta property="og:image" content="c:/primary-project/stm32/学习心得/下拉输入模式.png">
<meta property="og:image" content="c:/primary-project/stm32/学习心得/模拟输入模式.png">
<meta property="og:image" content="c:/primary-project/stm32/学习心得/开漏输出模式.png">
<meta property="og:image" content="c:/primary-project/stm32/学习心得/开漏复用输出模式.png">
<meta property="og:image" content="c:/primary-project/stm32/学习心得/推挽输出模式.png">
<meta property="og:image" content="c:/primary-project/stm32/学习心得/推挽复用输出模式.png">
<meta property="og:image" content="c:/primary-project/stm32/学习心得/推挽与开漏的区别.jpg">
<meta property="article:published_time" content="2021-03-22T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-23T16:32:21.983Z">
<meta property="article:author" content="smallcracker">
<meta property="article:tag" content="stm32">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/03/23/002-GPIO/20180408224319518.png">
  
    <link rel="alternate" href="/atom.xml" title="Welcome to smallcracker's personal website" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Welcome to smallcracker&#39;s personal website</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">联系方式：1426090870</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-002-GPIO" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/23/002-GPIO/" class="article-date">
  <time class="dt-published" datetime="2021-03-22T16:00:00.000Z" itemprop="datePublished">2021-03-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      stm32_GPIO
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="stm32-GPIO"><a href="#stm32-GPIO" class="headerlink" title="stm32 GPIO"></a>stm32 GPIO</h1><h2 id="GPIO基本结构"><a href="#GPIO基本结构" class="headerlink" title="GPIO基本结构"></a>GPIO基本结构</h2><p><img src="20180408224319518.png" alt="basic_structure"><br>说明：  </p>
<ul>
<li>保护二极管：IO引脚上下两边两个二极管用于防止引脚外部过高、过低的电压输入。当引脚电压高于VDD时，上方的二极管导通；当引脚电压低于VSS时，下方的二极管导通，防止不正常电压引入芯片导致芯片烧毁。但是尽管如此，还是不能直接外接大功率器件，须加大功率及隔离电路驱动，防止烧坏芯片或者外接器件无法正常工作。</li>
<li>P-MOS管和N-MOS管：由P-MOS管和N-MOS管组成的单元电路使得GPIO具有“推挽输出”和“开漏输出”的模式。这里的电路会在下面很详细地分析到。</li>
<li>TTL肖特基触发器：信号经过触发器后，模拟信号转化为0和1的数字信号。但是，当GPIO引脚作为ADC采集电压的输入通道时，用其“模拟输入”功能，此时信号不再经过触发器进行TTL电平转换。ADC外设要采集到的原始的模拟信号。<h3 id="浮空输入模式"><a href="#浮空输入模式" class="headerlink" title="浮空输入模式"></a>浮空输入模式</h3><img src="浮空输入.png" alt="浮空输入"><br>浮空输入模式下，I/O端口的电平信号直接进入输入数据寄存器。也就是说，I/O的电平状态是不确定的，完全由外部输入决定；如果在该引脚悬空（在无信号输入）的情况下，读取该端口的电平是不确定的。</li>
</ul>
<h3 id="上拉输入模式"><a href="#上拉输入模式" class="headerlink" title="上拉输入模式"></a>上拉输入模式</h3><p><img src="C:\primary-project\stm32\学习心得\上拉输入模式.png" alt="上拉输入"><br>上拉输入模式下，I/O端口的电平信号直接进入输入数据寄存器。但是在I/O端口悬空（在无信号输入）的情况下，输入端的电平可以保持在高电平；并且在I/O端口输入为低电平的时候，输入端的电平也还是低电平。</p>
<h3 id="下拉输入模式"><a href="#下拉输入模式" class="headerlink" title="下拉输入模式"></a>下拉输入模式</h3><p><img src="C:\primary-project\stm32\学习心得\下拉输入模式.png" alt="下拉输入模式"></p>
<p>下拉输入模式下，I/O端口的电平信号直接进入输入数据寄存器。但是在I/O端口悬空（在无信号输入）的情况下，输入端的电平可以保持在低电平；并且在I/O端口输入为高电平的时候，输入端的电平也还是高电平。</p>
<h3 id="模拟输入模式"><a href="#模拟输入模式" class="headerlink" title="模拟输入模式"></a>模拟输入模式</h3><p><img src="C:\primary-project\stm32\学习心得\模拟输入模式.png" alt="模拟输入模式"></p>
<p>模拟输入模式下，I/O端口的模拟信号（电压信号，而非电平信号）直接模拟输入到片上外设模块，比如ADC模块等等。</p>
<h3 id="开漏输出模式"><a href="#开漏输出模式" class="headerlink" title="开漏输出模式"></a>开漏输出模式</h3><p><img src="C:\primary-project\stm32\学习心得\开漏输出模式.png" alt="开漏输出模式"></p>
<p>和厕所的浮阀一样，没有信号时，电平上下浮动，有输出时（相当于浮阀被按下），电平被拉低。</p>
<p>开漏输出模式下，通过设置位设置/清除寄存器或者输出数据寄存器的值，途经N-MOS管，最终输出到I/O端口。这里要注意N-MOS管，当设置输出的值为高电平的时候，N-MOS管处于关闭状态，此时I/O端口的电平就不会由输出的高低电平决定，而是由I/O端口外部的上拉或者下拉决定；当设置输出的值为低电平的时候，N-MOS管处于开启状态，此时I/O端口的电平就是低电平。同时，I/O端口的电平也可以通过输入电路进行读取；注意，I/O端口的电平不一定是输出的电平。</p>
<h3 id="开漏复用输出模式"><a href="#开漏复用输出模式" class="headerlink" title="开漏复用输出模式"></a>开漏复用输出模式</h3><p><img src="C:\primary-project\stm32\学习心得\开漏复用输出模式.png" alt="开漏复用输出模式"></p>
<p>开漏复用输出模式，与开漏输出模式很是类似。只是输出的高低电平的来源，不是让CPU直接写输出数据寄存器，取而代之利用片上外设模块的复用功能输出来决定的。</p>
<h3 id="推挽输出模式"><a href="#推挽输出模式" class="headerlink" title="推挽输出模式"></a>推挽输出模式</h3><p><img src="C:\primary-project\stm32\学习心得\推挽输出模式.png" alt="推挽输出模式"></p>
<p>很是自由，想高就一定高，相低就一定低。</p>
<p>推挽输出模式下，通过设置位设置/清除寄存器或者输出数据寄存器的值，途经P-MOS管和N-MOS管，最终输出到I/O端口。这里要注意P-MOS管和N-MOS管，当设置输出的值为高电平的时候，P-MOS管处于开启状态，N-MOS管处于关闭状态，此时I/O端口的电平就由P-MOS管决定：高电平；当设置输出的值为低电平的时候，P-MOS管处于关闭状态，N-MOS管处于开启状态，此时I/O端口的电平就由N-MOS管决定：低电平。同时，I/O端口的电平也可以通过输入电路进行读取；注意，此时I/O端口的电平一定是输出的电平。</p>
<h3 id="推挽复用输出模式"><a href="#推挽复用输出模式" class="headerlink" title="推挽复用输出模式"></a>推挽复用输出模式</h3><p><img src="C:\primary-project\stm32\学习心得\推挽复用输出模式.png" alt="推挽复用输出模式"></p>
<p>推挽复用输出模式，与推挽输出模式很是类似。只是输出的高低电平的来源，不是让CPU直接写输出数据寄存器，取而代之利用片上外设模块的复用功能输出来决定的。</p>
<h2 id="怎样选择输出模式"><a href="#怎样选择输出模式" class="headerlink" title="怎样选择输出模式"></a>怎样选择输出模式</h2><ul>
<li><p>推挽输出是虎妈，对电平有绝对控制权，开漏输出是猫爸，只会在必要的时候拉低电平（其实我们可以加用外部电阻来拉高），如图所示  </p>
<p><img src="C:\primary-project\stm32\学习心得\推挽与开漏的区别.jpg" alt="图片"></p>
</li>
<li><p>I2C的SCL、SDA使用复用推挽输出</p>
</li>
<li><p>TX1、MOSI、MISO.SCK.SS使用复用开漏输出功能</p>
</li>
</ul>
<h2 id="怎样选择输入模式"><a href="#怎样选择输入模式" class="headerlink" title="怎样选择输入模式"></a>怎样选择输入模式</h2><ul>
<li>按键使用浮空输入</li>
<li>ADC功能使用模拟输入</li>
</ul>
<h2 id="相关寄存器"><a href="#相关寄存器" class="headerlink" title="相关寄存器"></a>相关寄存器</h2><p>CRL、CRH、IDR、ODR</p>
<p>每一组IO都有这样几个寄存器</p>
<h3 id="CRL和CRH"><a href="#CRL和CRH" class="headerlink" title="CRL和CRH"></a>CRL和CRH</h3><p>负责配置串口是输入还是输出，什么串口模式。每一个串口的配置是4bit，也就是十六进制下的一位</p>
<p>所以，在十六进制下，这就是两个八位数，每一位都对应着一组串口的配置，常用配置：</p>
<ul>
<li>0x0 模拟输入，ADC使用</li>
<li>0x3 推挽输出模式，做输出口用，50M速率</li>
<li>0x8 上下拉输入模式，做输入口用</li>
<li>0xb 复用输出，50M速率</li>
</ul>
<h3 id="IDR"><a href="#IDR" class="headerlink" title="IDR"></a>IDR</h3><p>每一个IO口的状态，只是用了低16位</p>
<h3 id="ODR"><a href="#ODR" class="headerlink" title="ODR"></a>ODR</h3><p>端口输出数据寄存器</p>
<h2 id="初始化过程"><a href="#初始化过程" class="headerlink" title="初始化过程"></a>初始化过程</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RCC-&gt;APB2ENR|=<span class="number">1</span>&lt;&lt;<span class="number">2</span>; <span class="comment">//使能 PORTA 时钟</span></span><br><span class="line">GPIOA-&gt;CRH&amp;=<span class="number">0XFFFFFFF0</span>; <span class="comment">//清除PA8的配置</span></span><br><span class="line">GPIOA-&gt;CRH|=<span class="number">0X00000003</span>;<span class="comment">//PA8 推挽输出</span></span><br><span class="line">GPIOA-&gt;ODR|=<span class="number">1</span>&lt;&lt;<span class="number">8</span>; <span class="comment">//PA8 输出高</span></span><br></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>可以使用位带操作来进行，例如：我要 PORTA 的第七个 IO 口输出 1，则可以使用 <code>PAout(6)=1;</code>即可实现。我要判断 PORTA 的第 15 个位是否等于 1，则可以使用<code>if(Pain(14)==1)</code>就可以了。位带操作其实读写IDR和ODR的简便写法。</p>
<hr>
<h1 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客"></a>参考博客</h1><p>本文为CSDN博主「Yngz_Miao」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38410730/article/details/79858906">https://blog.csdn.net/qq_38410730/article/details/79858906</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/23/002-GPIO/" data-id="ckmm8lhhd0001d83d8v746ewg" data-title="stm32_GPIO" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stm32/" rel="tag">stm32</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2021/03/15/001-%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">new project</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/" rel="tag">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/midi/" rel="tag">midi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stm32/" rel="tag">stm32</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/midi/" style="font-size: 10px;">midi</a> <a href="/tags/stm32/" style="font-size: 15px;">stm32</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 20px;">单片机</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/23/002-GPIO/">stm32_GPIO</a>
          </li>
        
          <li>
            <a href="/2021/03/15/001-%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B/">new project</a>
          </li>
        
          <li>
            <a href="/2021/03/15/%E5%8D%95%E7%89%87%E6%9C%BA%E6%A6%82%E5%86%B5/">单片机概况</a>
          </li>
        
          <li>
            <a href="/2021/03/07/permutation/">generate permutation</a>
          </li>
        
          <li>
            <a href="/2021/03/06/%E4%BC%91%E7%9C%A0%E6%A8%A1%E5%9D%97/">休眠模块</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 smallcracker<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<!--script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>